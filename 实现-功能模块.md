# 功能模块


## 功能列表
- 个人奖池
- 刮刮卡
- 暗送

## 个人奖池
UserPoll

### 需求
要求 跟四人捕鱼、二人捕鱼做数据互通


### 方案
所有游戏共用四人捕鱼玩家服务器数据中个人奖池数据

### 数据


### 配置
UserPool.lua
```
	-- 免费抽奖系统开关
	["Enable"] = true,
	-- 限制
	["Limit"] = {
		-- 奖池累积上限
		["PoolMax"] =  37337299,
	},
	-- 奖金鱼
	["AwardFish"] = {
		--进入奖池比例
		["Share"] = 0.1
	},
	
	-- 鱼雷
	["Torpedo"] = {
		-- 奖金计算公式(注：修改时请确保公式平衡MinRatio * nBet + for :n {ratio * nBet * (1 + (-1.0, 1.0))})
		-- 最小系数, 最大系数, 随机次数, 单次随机倍率, 单次随机数范围
		["Formula"] = {minMulti = 0.8, maxMulti = 1.2, randTimes = 20, eachMulti = 0.01, left = -1.0, right = 1.0},	
		-- 高等级弹头
		["HigherTorpedo"] = {602, 603},
	},
```


### 代码
UserPool.h UserPool.cpp

gainProp  // 抽奖

### 测试 
改哪里能够快速累积池子数量

打死奖金鱼累积池子数量

直接改db玩家游戏数据中 8 v1 的值, 注意要改四人捕鱼的数据库，因为做了互通

--------

## 刮刮卡

### 刮刮卡
tapd文档 [地址](https://www.tapd.cn/60204148/prong/stories/view/1160204148001017076?url_cache_key=7bd304b65d5653521cce5bc5bcf8fbea&action_entry_type=story_tree_list)

玩法核心
```
把玩家输掉的钱按比例，以刮刮卡的形式暗送回去
```

### 数据存储
数据类型: PartIdCard

```
PartIdCard 5
示例: "5": "{\"v1\":0,\"v10\":0,\"v11\":0,\"v12\":0,\"v13\":0,\"v2\":0,\"v3\":0,\"v4\":0,\"v5\":0,\"v6\":0,\"v7\":0,\"v8\":0,\"v9\":0}",

v1-v10
v11: 卡类型 
v12: 基数
v13: 倍数

类 Card.h Card.cpp

```

### 配置
GiveCard.lua


### 流程
累计
掉落
兑换  单张、批量


### 消息处理
1.刮开卡片
CSScratchGivenCard
2.兑换卡片
CSExchangeGivenCard





--------


## 暗送
sfsd

--------